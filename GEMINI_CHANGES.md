# 카카오 로그아웃 UI 업데이트 문제 해결 과정

## 1. 문제 상황

카카오 로그아웃을 실행한 후, 사용자가 카카오 계정 페이지에서 로그아웃을 완료하고 다시 쇼핑몰 페이지로 돌아와도 헤더의 '로그아웃' 버튼이 '로그인'으로 즉시 변경되지 않았습니다. 새로고침을 해야만 UI가 올바르게 업데이트되었습니다.

이는 카카오 로그아웃 후 우리 앱의 인증 상태(user state)가 제때 업데이트되지 않아 발생하는 문제였습니다.

## 2. 해결 과정

### 첫 번째 시도: `kakaoLogout` 함수 수정

- **내용**: `AuthContext.tsx`의 `kakaoLogout` 함수에서, 카카오 로그아웃 URL로 이동하기 전에 먼저 내부 `logout()` 함수를 호출하여 앱의 상태를 변경하려고 시도했습니다.
- **문제점**: 사용자가 카카오 로그아웃 페이지에서 실제로 로그아웃하지 않고 '돌아가기'를 선택할 경우, 우리 앱에서는 이미 로그아웃 처리가 되어버리는 논리적 오류가 발생했습니다.

### 두 번째 시도: `SNSLogout.tsx`에서 비동기 처리 보장

- **내용**: 카카오 로그아웃 후 리디렉션되는 `SNSLogout.tsx` 페이지에서, `logout()` 함수의 비동기 처리가 완료된 후에 홈으로 이동하도록 `useState`를 사용하여 상태를 관리했습니다.
- **문제점**: 여전히 UI가 즉시 업데이트되지 않았습니다. `logout()` 함수가 상태를 업데이트하고 컴포넌트가 리렌더링되기 전에 페이지 이동이 먼저 발생하는 타이밍 문제가 있는 것으로 추정되었습니다.

### 세 번째 시도: `SNSLogout.tsx`에서 `user` 상태 직접 감시

- **내용**: `SNSLogout.tsx`가 `AuthContext`의 `user` 상태를 직접 구독하고, `user`가 `null`이 되면 (로그아웃이 완료되면) 홈으로 이동하도록 로직을 변경했습니다.
- **문제점**: 이 방식은 오히려 로그아웃 흐름을 방해하여 로그아웃이 제대로 실행되지 않는 결과를 낳았습니다.

### 최종 해결: `loading` 상태 도입으로 동기화 문제 해결

- **원인 분석**: 앱이 처음 로드될 때 실행되는 로그인 상태 확인(`checkLoginStatus`)과, 카카오 로그아웃 후 리디렉션되어 실행되는 로그아웃 로직(`SNSLogout.tsx`) 사이에 경쟁 상태(Race Condition)가 발생하는 것을 최종 원인으로 파악했습니다. 즉, 아직 로그인 상태 확인이 끝나지 않았는데 로그아웃 로직이 실행되어 상태가 꼬이는 것이었습니다.

- **해결 방안**:
    1.  **`AuthContext.tsx` 수정**:
        -   `loading` 상태 변수를 추가했습니다. 이 변수는 앱 시작 시 `true`로 설정됩니다.
        -   최초 로그인 상태 확인(`checkLoginStatus`)이 완전히 끝난 후에 `loading`을 `false`로 변경합니다.
        -   이 `loading` 상태를 `AuthContext`를 통해 하위 컴포넌트에 제공합니다.

    2.  **`SNSLogout.tsx` 수정**:
        -   `AuthContext`로부터 `loading` 상태를 받아옵니다.
        -   `useEffect` 훅에서 `!loading && user` 조건을 추가하여, **반드시 앱의 초기 로딩이 끝난 후, 그리고 사용자가 로그인 상태일 때만** `logout()` 함수를 호출하도록 보장했습니다.
        -   `!loading && !user` 조건에서 홈으로 리디렉션하여, **초기 로딩이 끝났고, 사용자 상태가 로그아웃(`null`)일 때** 안전하게 페이지를 이동시킵니다.

## 3. 결론

`loading` 상태를 도입하여 앱의 초기 인증 상태 확인과 로그아웃 로직 실행 시점을 명확하게 분리함으로써, 경쟁 상태(Race Condition)를 해결하고 로그아웃 시 UI가 즉시 올바르게 업데이트되도록 문제를 해결했습니다.
